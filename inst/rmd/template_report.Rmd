---
title: "MQmetrics Report"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: pdf_document
params:
  input_dir: ''
  log_base: ''
  long_names: ''
  sep_names: ''
  intensity_type: ''
  palette: ''
  UniprotID: ''
  segment_width: ''
  show_shade: ''
  percent_proteins: ''
  show_calibrated_rt: ''
  tolerance: ''
  show_max_value: ''
  peptides_modified: ''
  show_median: ''
  binwidth: ''
  plot_unmodified_peptides: ''
---

```{r setup, include=FALSE}
## global options
knitr::opts_chunk$set(echo=FALSE,
                      warning=FALSE,
                      error=FALSE,
                      message=FALSE, 
                      fig.height = 12,
                      fig.width = 10)
```

```{r library}
library(MQmetrics)
MQPathCombined <- params$input_dir
files <- ReadDataFromDir(MQPathCombined) 
summary <- files[["summary.txt"]]
evidence <- files[["evidence.txt"]]
msScans <- files[['msScans.txt']]
peptides <- files[["peptides.txt"]]
msmsScans <- files[["msmsScans.txt"]]
proteinGroups <- files[["proteinGroups.txt"]]
modificationSpecificPeptides <- files[["modificationSpecificPeptides.txt"]]
runningTimes <-  files[["#runningTimes.txt"]]
parameters <- files[["parameters.txt"]]
```



```{r ExperimentDuration}
ExperimentInformation(MQPathCombined,
                      runningTimes, 
                      parameters) 
```

\newpage

```{r PlotProteins}
PlotProteinsIdentified(proteinGroups,
                       intensity_type =params$intensity_type,
                       long_names = params$long_names, 
                       sep_names = params$sep_names, 
                       palette = params$palette)
```

\newpage
```{r protein_coverage_all}
PlotProteinCoverageAll(proteinGroups)

```

\newpage
```{r PeptidesIdentified}
PlotPeptidesIdentified(summary, 
                       long_names = params$long_names, 
                       sep_names = params$sep_names, 
                       palette = params$palette)
```



\newpage
```{r PlotMSMS}
PlotMsMs(summary,
         long_names = params$long_names, 
         sep_names = params$sep_names, 
         palette = params$palette)
```


\newpage
```{r PlotPeaks}
PlotPeaks(summary, 
          long_names = params$long_names, 
          sep_names = params$sep_names, 
          palette = params$palette)
```


\newpage
```{r isotope}
PlotIsotopePattern(summary,
                   long_names = params$long_names, 
                   sep_names = params$sep_names, 
                   palette = params$palette)
```


\newpage
```{r Charge}
PlotCharge(evidence, 
           palette = params$palette)
```

\newpage
```{r missed_cleavages}
PlotProteaseSpecificity(peptides, 
                        palette = params$palette)
```


\newpage
```{r PlotHydrophobicity}
PlotHydrophobicity(peptides,
          palette = params$palette,
          show_median =  params$show_median,
          binwidth = params$binwidth)
```

\newpage
```{r PlotAndromedaScore}
PlotAndromedaScore(peptides, 
                   palette = params$palette)
```


\newpage
```{r IdentificationType}
if(parameters$Value[27] == "True"){
  PlotIdentificationType(peptides, 
                         proteinGroups,
                         palette = params$palette,
                         long_names = params$long_names, 
                         sep_names = params$sep_names)  
} else{
  cat('Match Between Runs was not used during the MaxQuant analysis.
No Identification Type to show.')
}
```



\newpage
```{r PlotIntensity}
PlotIntensity(proteinGroups, 
              intensity_type = params$intensity_type, 
              log_base = params$log_base, 
              long_names = params$long_names, 
              sep_names = params$sep_names,
              palette = params$palette)
```
\newpage

```{r PlotPCA}
PlotPCA(proteinGroups,
        intensity_type = params$intensity_type,
        palette = params$palette)
```

\newpage
```{r DynamicRange}
PlotCombinedDynamicRange(proteinGroups,
                         show_shade = params$show_shade, 
                         percent_proteins = params$percent_proteins) 
```
\newpage
```{r DynamicRangeAll}
PlotAllDynamicRange(proteinGroups,
                    show_shade = params$show_shade, 
                    percent_proteins = params$percent_proteins)
```

\newpage

```{r ProteinCoverage}
if(is.null(params$UniprotID)){
  print('No UniprotID provided.')
} else{
PlotProteinCoverage(peptides, 
                    proteinGroups, 
                    UniprotID = params$UniprotID, 
                    log_base = params$log_base,
                    segment_width = params$segment_width,
                    palette = params$palette)
}
```



\newpage
```{r irt_peps1}
PlotiRT(evidence, 
        show_calibrated_rt = params$show_calibrated_rt)
```
\newpage

```{r irt_peps2}
PlotiRTScore(evidence)
```



\newpage
```{r TotalIonCurrent}
PlotTotalIonCurrent(msmsScans,
                    show_max_value = params$show_max_value,
                    palette = params$palette)
```


\newpage
```{r PlotAcquisition}
PlotAcquisitionCycle(msScans, 
                     palette = params$palette)
```

\newpage
```{r PTM}
PlotPTM(modificationSpecificPeptides, 
        peptides_modified = params$peptides_modified,
        log_base = params$log_base,
        plot_unmodified_peptides = params$plot_unmodified_peptides,
        palette = params$palette)
```

\newpage
```{r, echo=FALSE, message=FALSE, warning=FALSE}
a <- ReportTables(MQPathCombined =  params$input_dir,
             log_base = params$log_base,
             intensity_type = params$intensity_type)


kable(a[[1]], caption = 'Protein Information')
kable(a[[2]], caption =  paste0('Information of: Log', params$log_base,' ', params$intensity_type))   
kable(a[[3]], caption = 'Charge Information')
kable(a[[4]], caption = 'Peptide hydrophobicity (GRAVY)')

```
